# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ ÙˆØ¨ Ø³Ø±ÙˆÛŒØ³ TSETMC

## Ù…Ù‚Ø¯Ù…Ù‡

ÙˆØ¨ Ø³Ø±ÙˆÛŒØ³ TSETMC (Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨ÙˆØ±Ø³ ØªÙ‡Ø±Ø§Ù†) Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø§Ø² APIÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÛŒØ±Ø§Ù† Ø§Ø³Øª. Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø§Ø² Ø§ÛŒÙ† APIÙ‡Ø§ Ø±Ø§ ØªÙˆØ¶ÛŒØ­ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

### ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ
- âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ùˆ ØªØ§Ø±ÛŒØ®ÛŒ
- âœ… Ù¾ÙˆØ´Ø´ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²Ø§Ø± Ø¨ÙˆØ±Ø³ØŒ ÙØ±Ø§Ø¨ÙˆØ±Ø³ Ùˆ Ø¨ÙˆØ±Ø³ Ú©Ø§Ù„Ø§
- âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ OHLCVØŒ Ù…Ø¹Ø§Ù…Ù„Ø§ØªØŒ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§
- âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø§Ù†ÙˆØ§Ø¹ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ùˆ Ø¨Ù†ÛŒØ§Ø¯ÛŒ
- âœ… Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡ ÛµÛ°,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª

## âš ï¸ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù… Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…ØµØ±Ù ØºÛŒØ±Ù…Ø¬Ø§Ø² API
**Ø³Ù„Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒØŒ**

Ø¨Ø±Ø±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø´Ù…Ø§ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² ØªØ¹Ø±ÛŒÙâ€ŒØ´Ø¯Ù‡ ÙØ±Ø§ØªØ± Ø±ÙØªÙ‡ Ø§Ø³Øª.

Ù„Ø§Ø²Ù… Ø§Ø³Øª Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø±ÛŒÚ©ÙˆØ¦Ø³Øª Ø¨ÛŒØ´ Ø§Ø² Ø¸Ø±ÙÛŒØª Ø±Ø§ Ù…ØªÙˆÙ‚Ù Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²ØŒ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø§Ø±ØªÙ‚Ø§ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø² Ø±ÙˆØ²Ø§Ù†Ù‡ Ø§Ù‚Ø¯Ø§Ù… Ù†Ù…Ø§ÛŒÛŒØ¯.

Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ù†ØµÙØ§Ù†Ù‡ BrsApiØŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ø±Ø± Ùˆ Ø¨Ø¯ÙˆÙ† Ù…Ù†Ø·Ù‚ Ú©Ù‡ Ù…Ù†Ø¬Ø± Ø¨Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø± Ø§Ø¶Ø§ÙÛŒ Ø¨Ø± Ø±ÙˆÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§ Ø´ÙˆØ¯ØŒ ØªØ®Ù„Ù Ù…Ø­Ø³ÙˆØ¨ Ø´Ø¯Ù‡ Ùˆ Ù…Ù†Ø¬Ø± Ø¨Ù‡ Ù…Ø³Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø¦Ù…ÛŒ Ùˆ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ù„ÛŒØ¯ APIØŒ Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ÛŒ Ø´Ù…Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.

âš ï¸ **Ø¯Ø± ØµÙˆØ±ØªÛŒÚ©Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø±ÛŒÚ©ÙˆØ¦Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø¸Ø±ÙÛŒØª Ù…Ø¬Ø§Ø² Ø¨Ù‡ 500 Ø¹Ø¯Ø¯ Ø¨Ø±Ø³Ø¯ØŒ Ú©Ù„ÛŒÙ‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø­Ø¬ÛŒÙ… Ù‡Ø¯Ø§ÛŒØª Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.** Ø§ÛŒÙ† Ø§Ù‚Ø¯Ø§Ù… Ø¨Ø§ Ù‡Ø¯Ù Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙØ´Ø§Ø± Ø§Ø¶Ø§ÙÛŒ Ø¨Ø± Ø³Ø±ÙˆØ± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ Ùˆ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§Ø¹Ø« Ú©Ù†Ø¯ÛŒ ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ø®ÙˆØ§Ø³ØªÙ‡ Ø³Ù…Øª Ú©Ø§Ø±Ø¨Ø± Ø´ÙˆØ¯.

Ù„Ø·ÙØ§Ù‹ Ø¬Ù‡Øª Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø±ÙˆØ² Ø§ÛŒÙ† Ù…Ø´Ú©Ù„Ø§ØªØŒ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù„Ø§Ø²Ù… Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.

### Ú©Ù„ÛŒØ¯ Ø¯Ø³ØªØ±Ø³ÛŒ API
Ú©Ù„ÛŒØ¯ Ø¯Ø³ØªØ±Ø³ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ ÙˆØ¨â€ŒØ³Ø±ÙˆÛŒØ³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØµØ§Ø¯Ø± Ø´Ø¯:

```
BA9C8JBliDmfPapn9WYTX76uR5Q3m2r3
```

Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù†Ù…Ø§ÛŒÛŒØ¯. Ø¯Ø± ØµÙˆØ±Øª Ø§Ø² Ø¯Ø³Øªâ€ŒØ¯Ø§Ø¯Ù†ØŒ Ø§Ù…Ú©Ø§Ù† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ø¨Ø§ Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø®Ø¯Ù…Ø§Øª ÙˆØ¨â€ŒØ³Ø±ÙˆÛŒØ³ Ø³Ø§ÛŒØª BrsApi.ir Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…Ø§ÛŒÛŒØ¯.

### ğŸ”” Ù†Ú©ØªÙ‡ Ø­ÛŒØ§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Python
Ø§Ú¯Ø± Ø§Ø² Ø²Ø¨Ø§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Python Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ ÙˆØ¨â€ŒØ³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŒ ØªÙˆØ¬Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ú©Ù‡ **User-Agent Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù¾Ø§ÛŒØªÙˆÙ† Ø·Ø¨Ù‚ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 6G Firewall Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø³Ø¯ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯**.

âœ… **Ø§Ù„Ø²Ø§Ù…Ø§ Ø¬Ù‡Øª Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ù…Ø´Ú©Ù„ØŒ Ø·Ø¨Ù‚ Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø¯ÛŒ Ú©Ù‡ Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø³Ø§ÛŒØª Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ØŒ Ø§Ø² ÛŒÚ© User-Agent Ù…Ø¹ØªØ¨Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.** Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª IP Ø´Ù…Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ø±ÛŒÚ©ÙˆØ¦Ø³Øª ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø³Ø§ÛŒØª Ù†Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø´Øª.

### Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ù†ØµÙØ§Ù†Ù‡
- **Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Ù…Ø¬Ù…ÙˆØ¹ ÛµÛ°,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø±ÙˆØ²
- **Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øª:** Ø­Ø¯Ø§Ú©Ø«Ø± Û¶Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡
- **Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ù†Ø·Ù‚ÛŒ:** Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ø±Ø± Ø¨Ø¯ÙˆÙ† Ù…Ù†Ø·Ù‚ ØªØ®Ù„Ù Ø§Ø³Øª
- **Ù…Ø³Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ:** Ø¯Ø± ØµÙˆØ±Øª ØªØ®Ù„ÙØŒ Ú©Ù„ÛŒØ¯ API Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ø³Ø¯ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- **Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ:** Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø­Ø¬ÛŒÙ… Ù‡Ø¯Ø§ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

### Ù†Ú©Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ù…Ù‡Ù…
- Ú©Ù„ÛŒØ¯ API Ø±Ø§ Ø¯Ø± Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯
- Ø§Ø² Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ù†Ø±Ø® Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø§Ù†ÛŒØªÙˆØ± Ú©Ù†ÛŒØ¯
- Ø¯Ø± ØµÙˆØ±Øª Ù…Ø´Ú©Ù„ØŒ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯

## Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ Ø¯Ø±ÛŒØ§ÙØª API Key

1. Ø¨Ù‡ ÙˆØ¨â€ŒØ³Ø§ÛŒØª [brsapi.ir](https://brsapi.ir) Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯
2. Ø¯Ø± Ø¨Ø®Ø´ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
3. Ù¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„ØŒ API Key Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯
4. API Key Ø±Ø§ Ø¯Ø± Ù…ØªØºÛŒØ± Ù…Ø­ÛŒØ·ÛŒ `BRS_API_KEY` Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯

```bash
# Ø¯Ø± ÙØ§ÛŒÙ„ .env
BRS_API_KEY=your_api_key_here
```

## ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø± Ù¾Ø§ÛŒØªÙˆÙ†

### Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
```bash
pip install requests python-dotenv
```

### ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ (Ø­Ù„ Ù…Ø´Ú©Ù„ ÙØ§ÛŒØ±ÙˆØ§Ù„ Ù†Ø³Ù„ Û¶)
**âš ï¸ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø³ÛŒØ§Ø± Ù…Ù‡Ù… Ø§Ø³Øª - Ø¹Ø¯Ù… Ø±Ø¹Ø§ÛŒØª Ø¢Ù† Ù…Ù†Ø¬Ø± Ø¨Ù‡ Ù…Ø³Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ IP Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯**

ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬ Ø¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² APIÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒØŒ Ø¨Ù„Ø§Ú© Ø´Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ† ØªÙˆØ³Ø· ÙØ§ÛŒØ±ÙˆØ§Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ø³Ù„ Ø¬Ø¯ÛŒØ¯ (6G Firewall) Ø§Ø³Øª. Ø§ÛŒÙ† Ù…Ø´Ú©Ù„ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ… User-Agent Ù…Ù†Ø§Ø³Ø¨ Ø­Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯:

```python
import requests
import os
from dotenv import load_dotenv

load_dotenv()

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Session Ø¨Ø§ User-Agent Ù…Ù†Ø§Ø³Ø¨ (Ø§Ù„Ø²Ø§Ù…ÛŒ!)
session = requests.Session()
session.headers.update({
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36",
    "Accept": "application/json, text/plain, */*",
    "Accept-Language": "en-US,en;q=0.9,fa;q=0.8",
    "Accept-Encoding": "gzip, deflate, br",
    "DNT": "1",
    "Connection": "keep-alive",
    "Upgrade-Insecure-Requests": "1",
})

# Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ
API_KEY = os.getenv("BRS_API_KEY")
BASE_URL = "https://brsapi.ir"
```

### Ú©Ù„Ø§Ø³ Ú©Ù„Ø§ÛŒÙ†Øª Ø¢Ù…Ø§Ø¯Ù‡

```python
import requests
import time
from typing import Dict, List, Any, Optional

class TSETMCClient:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://brsapi.ir"
        self.session = requests.Session()
        self.session.headers.update({
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36",
            "Accept": "application/json, text/plain, */*",
            "Accept-Language": "en-US,en;q=0.9,fa;q=0.8",
            "Accept-Encoding": "gzip, deflate, br",
            "DNT": "1",
            "Connection": "keep-alive",
            "Upgrade-Insecure-Requests": "1",
        })

    def _make_request(self, endpoint: str, params: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§"""
        url = f"{self.base_url}/{endpoint}"
        request_params = {"key": self.api_key}
        if params:
            request_params.update(params)

        try:
            response = self.session.get(url, params=request_params, timeout=30)
            response.raise_for_status()
            return response.json()
        except requests.exceptions.RequestException as e:
            print(f"Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª {endpoint}: {e}")
            return {}

    # Ù…ØªØ¯Ù‡Ø§ÛŒ API Ø¯Ø± Ø§Ø¯Ø§Ù…Ù‡ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
```

## APIÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ TSETMC

### Û±. Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ù†Ù…Ø§Ø¯Ù‡Ø§

**Endpoint:** `Api/Tsetmc/AllSymbols.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û±Û°,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¨ÙˆØ±Ø³ Ùˆ ÙØ±Ø§Ø¨ÙˆØ±Ø³

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `type`: Ù†ÙˆØ¹ Ø¨Ø§Ø²Ø§Ø± (Û± Ø¨Ø±Ø§ÛŒ Ø¨ÙˆØ±Ø³ØŒ Û² Ø¨Ø±Ø§ÛŒ ÙØ±Ø§Ø¨ÙˆØ±Ø³)

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
[
  {
    "l18": "ÙÙˆÙ„Ø§Ø¯",
    "l30": "ÙÙˆÙ„Ø§Ø¯ Ù…Ø¨Ø§Ø±Ú©Ù‡ Ø§ØµÙÙ‡Ø§Ù†",
    "insCode": "12345678901234567",
    "sector": "ÙÙ„Ø²ÛŒ",
    "market": "Ø¨ÙˆØ±Ø³"
  }
]
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_all_symbols(self, market_type: int = 1) -> List[Dict[str, Any]]:
    """Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ù†Ù…Ø§Ø¯Ù‡Ø§"""
    return self._make_request("Api/Tsetmc/AllSymbols.php", {"type": market_type})

# Ø§Ø³ØªÙØ§Ø¯Ù‡
client = TSETMCClient("your_api_key")
symbols = client.get_all_symbols()
print(f"ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…Ø§Ø¯Ù‡Ø§: {len(symbols)}")
```

### Û². Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù†Ù…Ø§Ø¯

**Endpoint:** `Api/Tsetmc/Symbol.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û¸,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ÛŒÚ© Ù†Ù…Ø§Ø¯ Ø´Ø§Ù…Ù„ Ù‚ÛŒÙ…ØªØŒ Ø­Ø¬Ù…ØŒ Ø§Ø±Ø²Ø´ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ùˆ ØºÛŒØ±Ù‡

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `l18`: Ú©Ø¯ Û±Û¸ Ø±Ù‚Ù…ÛŒ Ù†Ù…Ø§Ø¯ (Ù…Ø«Ø§Ù„: "ÙÙˆÙ„Ø§Ø¯")

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
{
  "symbol": "ÙÙˆÙ„Ø§Ø¯",
  "price": 1250,
  "volume": 1000000,
  "value": 1250000000,
  "last_trade": 1250,
  "change_percent": 2.5,
  "market_cap": 15000000000,
  "pe_ratio": 8.5
}
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_symbol_info(self, symbol: str) -> Dict[str, Any]:
    """Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù†Ù…Ø§Ø¯"""
    return self._make_request("Api/Tsetmc/Symbol.php", {"l18": symbol})

# Ø§Ø³ØªÙØ§Ø¯Ù‡
info = client.get_symbol_info("ÙÙˆÙ„Ø§Ø¯")
print(f"Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ ÙÙˆÙ„Ø§Ø¯: {info.get('price')}")
```

### Û³. Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ Ù‚ÛŒÙ…Øª

**Endpoint:** `Api/Tsetmc/History.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û´,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ OHLCV ØªØ§Ø±ÛŒØ®ÛŒ ÛŒÚ© Ù†Ù…Ø§Ø¯

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `l18`: Ú©Ø¯ Ù†Ù…Ø§Ø¯
- `type`: Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ (Û° Ø¨Ø±Ø§ÛŒ Ù‚ÛŒÙ…ØªØŒ Û± Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ)

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
[
  {
    "date": "2024-01-01",
    "open": 1200,
    "high": 1250,
    "low": 1180,
    "close": 1240,
    "volume": 500000,
    "value": 620000000
  }
]
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_price_history(self, symbol: str, data_type: int = 0) -> List[Dict[str, Any]]:
    """Ø¯Ø±ÛŒØ§ÙØª ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù‚ÛŒÙ…Øª"""
    return self._make_request("Api/Tsetmc/History.php", {
        "l18": symbol,
        "type": data_type
    })

# Ø§Ø³ØªÙØ§Ø¯Ù‡
history = client.get_price_history("ÙÙˆÙ„Ø§Ø¯")
print(f"ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ: {len(history)}")
```

### Û´. Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†Ø¯Ù„â€ŒØ§Ø³ØªÛŒÚ©

**Endpoint:** `Api/Tsetmc/Candlestick.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û²,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†Ø¯Ù„â€ŒØ§Ø³ØªÛŒÚ© Ø¨Ø§ Ø§Ù…Ú©Ø§Ù† ØªÙ†Ø¸ÛŒÙ… ØªØ¹Ø¯ÛŒÙ„ Ù‚ÛŒÙ…Øª

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `l18`: Ú©Ø¯ Ù†Ù…Ø§Ø¯
- `adjusted`: ØªØ¹Ø¯ÛŒÙ„ Ù‚ÛŒÙ…Øª (true/false)

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
[
  {
    "date": "2024-01-01",
    "open": 1200,
    "high": 1250,
    "low": 1180,
    "close": 1240,
    "volume": 500000
  }
]
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_candlestick(self, symbol: str, adjusted: bool = True) -> List[Dict[str, Any]]:
    """Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†Ø¯Ù„â€ŒØ§Ø³ØªÛŒÚ©"""
    return self._make_request("Api/Tsetmc/Candlestick.php", {
        "l18": symbol,
        "adjusted": str(adjusted).lower()
    })
```

### Ûµ. Ø±ÛŒØ²Ù…Ø¹Ø§Ù…Ù„Ø§Øª

**Endpoint:** `Api/Tsetmc/Transaction.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û±Û°,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±ÙˆØ²Ø§Ù†Ù‡ ÛŒÚ© Ù†Ù…Ø§Ø¯

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `l18`: Ú©Ø¯ Ù†Ù…Ø§Ø¯

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
[
  {
    "time": "09:00:00",
    "price": 1240,
    "volume": 1000,
    "buyer": "Ù…Ø´ØªØ±ÛŒ Ø­Ù‚ÙˆÙ‚ÛŒ",
    "seller": "ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ø­Ù‚ÛŒÙ‚ÛŒ"
  }
]
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_transactions(self, symbol: str) -> List[Dict[str, Any]]:
    """Ø¯Ø±ÛŒØ§ÙØª Ø±ÛŒØ²Ù…Ø¹Ø§Ù…Ù„Ø§Øª"""
    return self._make_request("Api/Tsetmc/Transaction.php", {"l18": symbol})
```

### Û¶. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ù‡Ø§Ù…Ø¯Ø§Ø±Ø§Ù†

**Endpoint:** `Api/Tsetmc/Shareholder.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û±,ÛµÛ°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ù„ÛŒØ³Øª Ø³Ù‡Ø§Ù…Ø¯Ø§Ø±Ø§Ù† Ø¹Ù…Ø¯Ù‡ ÛŒÚ© Ù†Ù…Ø§Ø¯

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `l18`: Ú©Ø¯ Ù†Ù…Ø§Ø¯

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
[
  {
    "name": "ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø§Ø²Ù†Ø´Ø³ØªÚ¯ÛŒ",
    "shares": 1000000,
    "percentage": 15.5,
    "change": 50000
  }
]
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_shareholders(self, symbol: str) -> List[Dict[str, Any]]:
    """Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ù‡Ø§Ù…Ø¯Ø§Ø±Ø§Ù†"""
    return self._make_request("Api/Tsetmc/Shareholder.php", {"l18": symbol})
```

### Û·. Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±

**Endpoint:** `Api/Tsetmc/Index.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û²,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ø¨ÙˆØ±Ø³ Ùˆ ÙØ±Ø§Ø¨ÙˆØ±Ø³

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `type`: Ù†ÙˆØ¹ Ø´Ø§Ø®Øµ (Û± Ø¨Ø±Ø§ÛŒ Ø¨ÙˆØ±Ø³ØŒ Û² Ø¨Ø±Ø§ÛŒ ÙØ±Ø§Ø¨ÙˆØ±Ø³)

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
[
  {
    "name": "Ø´Ø§Ø®Øµ Ú©Ù„",
    "value": 1500000,
    "change": 2500,
    "change_percent": 0.17
  }
]
```

#### Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯:
```python
def get_indices(self, index_type: int = 1) -> List[Dict[str, Any]]:
    """Ø¯Ø±ÛŒØ§ÙØª Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§"""
    return self._make_request("Api/Tsetmc/Index.php", {"type": index_type})
```

### Û¸. NAV ØµÙ†Ø¯ÙˆÙ‚â€ŒÙ‡Ø§ÛŒ ETF

**Endpoint:** `Api/Tsetmc/Nav.php`  
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡:** Û±,Û°Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª  
**ØªÙˆØ¶ÛŒØ­:** Ø§Ø±Ø²Ø´ Ø®Ø§Ù„Øµ Ø¯Ø§Ø±Ø§ÛŒÛŒ ØµÙ†Ø¯ÙˆÙ‚â€ŒÙ‡Ø§ÛŒ ETF

#### Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
- `l18`: Ú©Ø¯ ØµÙ†Ø¯ÙˆÙ‚

#### Ù¾Ø§Ø³Ø® Ù†Ù…ÙˆÙ†Ù‡:
```json
{
  "nav": 12500,
  "date": "2024-01-01",
  "change": 150
}
```

## Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øª

### Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡
| API | Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡ |
|-----|----------------|
| AllSymbols | Û±Û°,Û°Û°Û° |
| Symbol | Û¸,Û°Û°Û° |
| History | Û´,Û°Û°Û° |
| Candlestick | Û²,Û°Û°Û° |
| Transaction | Û±Û°,Û°Û°Û° |
| Shareholder | Û±,ÛµÛ°Û° |
| Index | Û²,Û°Û°Û° |
| Nav | Û±,Û°Û°Û° |
| **Ù…Ø¬Ù…ÙˆØ¹** | **ÛµÛ°,Û°Û°Û°** |

### Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øª
```python
import time
from collections import defaultdict

class RateLimiter:
    def __init__(self):
        self.requests = defaultdict(list)

    def can_make_request(self, endpoint: str) -> bool:
        """Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª"""
        now = time.time()
        # Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Û²Û´ Ø³Ø§Ø¹Øª
        self.requests[endpoint] = [t for t in self.requests[endpoint] if now - t < 86400]

        # Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡
        limits = {
            "Api/Tsetmc/AllSymbols.php": 10000,
            "Api/Tsetmc/Symbol.php": 8000,
            "Api/Tsetmc/History.php": 4000,
            # ... Ø³Ø§ÛŒØ± Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§
        }

        return len(self.requests[endpoint]) < limits.get(endpoint, 1000)

    def record_request(self, endpoint: str):
        """Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª"""
        self.requests[endpoint].append(time.time())
```

## Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´â€ŒÙ‡Ø§

### Û±. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Session
```python
# Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Session Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯
session = requests.Session()
# ØªÙ†Ø¸ÛŒÙ… headers ÛŒÚ© Ø¨Ø§Ø±
```

### Û². Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§
```python
def safe_api_call(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except requests.exceptions.ConnectionError:
            print("Ù…Ø´Ú©Ù„ Ø§ØªØµØ§Ù„ - Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†Øª")
        except requests.exceptions.Timeout:
            print("Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± ØªÙ…Ø§Ù… Ø´Ø¯ - Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯")
        except requests.exceptions.HTTPError as e:
            if e.response.status_code == 429:
                print("Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø® - ØµØ¨Ø± Ú©Ù†ÛŒØ¯")
            elif e.response.status_code == 403:
                print("API Key Ù†Ø§Ù…Ø¹ØªØ¨Ø±")
        return None
    return wrapper
```

### Û³. Ú©Ø´ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
```python
import json
from pathlib import Path

class DataCache:
    def __init__(self, cache_dir: str = "cache"):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(exist_ok=True)

    def get(self, key: str) -> Optional[Dict]:
        cache_file = self.cache_dir / f"{key}.json"
        if cache_file.exists():
            return json.loads(cache_file.read_text())
        return None

    def set(self, key: str, data: Dict, ttl: int = 3600):
        cache_file = self.cache_dir / f"{key}.json"
        cache_file.write_text(json.dumps(data))
```

### Û´. Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ÙˆØ§Ø²ÛŒ (Ø¨Ø§ Ø§Ø­ØªÛŒØ§Ø·)
```python
from concurrent.futures import ThreadPoolExecutor, as_completed

def fetch_multiple_symbols(symbols: List[str]) -> Dict[str, Dict]:
    results = {}
    with ThreadPoolExecutor(max_workers=5) as executor:
        future_to_symbol = {
            executor.submit(client.get_symbol_info, symbol): symbol
            for symbol in symbols
        }

        for future in as_completed(future_to_symbol):
            symbol = future_to_symbol[future]
            try:
                results[symbol] = future.result()
            except Exception as e:
                print(f"Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª {symbol}: {e}")

    return results
```

## Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ù…Ø´Ú©Ù„ ÙØ§ÛŒØ±ÙˆØ§Ù„ Ù†Ø³Ù„ Û¶ (6G Firewall)
**Ø¹Ù„Øª:** ÙØ§ÛŒØ±ÙˆØ§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ø±Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ† Ø±Ø§ Ø¨Ø§ User-Agent Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù„Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.

**Ø±Ø§Ù‡ Ø­Ù„:** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² User-Agent Ø´Ø¨ÛŒÙ‡ Ù…Ø±ÙˆØ±Ú¯Ø± (Ø§Ù„Ø²Ø§Ù…ÛŒ):
```python
headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36",
    "Accept": "application/json, text/plain, */*",
    "Accept-Language": "en-US,en;q=0.9,fa;q=0.8",
}
```

**âš ï¸ Ù‡Ø´Ø¯Ø§Ø±:** Ø¹Ø¯Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² User-Agent Ù…Ø¹ØªØ¨Ø± Ù…Ù†Ø¬Ø± Ø¨Ù‡ Ù…Ø³Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ IP Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

### Ù…ØµØ±Ù Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ API
**Ø¹Ù„Øª:** Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ø±Ø± Ø¨Ø¯ÙˆÙ† Ù…Ù†Ø·Ù‚.

**Ø±Ø§Ù‡ Ø­Ù„:**
- Ø§Ø² RateLimiter Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ø¨ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø­Ø¯Ø§Ù‚Ù„ Û± Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯
- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø±Ø§ Ù…Ø§Ù†ÛŒØªÙˆØ± Ú©Ù†ÛŒØ¯
- Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²ØŒ Ù¾Ù„Ù† Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ… Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯

**âš ï¸ Ø¹ÙˆØ§Ù‚Ø¨:** Ù…Ø³Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø¦Ù…ÛŒ API Key Ùˆ Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø­Ø¬ÛŒÙ….

### Ø®Ø·Ø§ÛŒ JSON Decode
**Ø¹Ù„Øª:** Ø¨Ø±Ø®ÛŒ APIÙ‡Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù¾Ø§Ø³Ø® ÙØ´Ø±Ø¯Ù‡ ÛŒØ§ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø¨Ø¯Ù‡Ù†Ø¯.

**Ø±Ø§Ù‡ Ø­Ù„:** Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Accept-Encoding Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø®:
```python
response = session.get(url, headers=headers)
response.encoding = 'utf-8'  # ØªÙ†Ø¸ÛŒÙ… encoding
data = response.json()
```

### Ø®Ø·Ø§ÛŒ 429 (Too Many Requests)
- Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ú©Ø§Ù‡Ø´ Ø¯Ù‡ÛŒØ¯
- Ø§Ø² RateLimiter Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ø¨ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ ØµØ¨Ø± Ú©Ù†ÛŒØ¯

### Ø®Ø·Ø§ÛŒ 403 (Forbidden)
- API Key Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
- Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Key Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
- User-Agent Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯

### Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„
- Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
- Ø§Ø² VPN Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø§Ø³Øª
- timeout Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯

### Ù†Ú©Ø§Øª Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†
- Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² try-except Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ API Ø±Ø§ validate Ú©Ù†ÛŒØ¯
- Ø§Ø² Ú©Ø´ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø±Ø§ Ø±Ø¹Ø§ÛŒØª Ú©Ù†ÛŒØ¯
- Ø¯Ø± ØµÙˆØ±Øª Ù…Ø´Ú©Ù„ØŒ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯

## Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ø§Ù…Ù„

```python
import os
import time
import requests
from typing import Dict, List, Any
from dotenv import load_dotenv

load_dotenv()

class TSETMCTrader:
    def __init__(self):
        self.client = TSETMCClient(os.getenv("BRS_API_KEY"))
        self.watchlist = ["ÙÙˆÙ„Ø§Ø¯", "Ø´Ù¾Ù†Ø§", "ÙˆØªØ¬Ø§Ø±Øª"]

    def analyze_market(self):
        """ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ Ø¨Ø§Ø²Ø§Ø±"""
        print("ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±...")

        # Ø¯Ø±ÛŒØ§ÙØª Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§
        indices = self.client.get_indices()
        for index in indices[:3]:  # Û³ Ø´Ø§Ø®Øµ Ø§ÙˆÙ„
            print(f"Ø´Ø§Ø®Øµ {index['name']}: {index['value']} ({index['change_percent']}%)")

        # ØªØ­Ù„ÛŒÙ„ Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒØ¯Ù‡â€ŒØ¨Ø§Ù†ÛŒ
        for symbol in self.watchlist:
            info = self.client.get_symbol_info(symbol)
            if info:
                print(f"{symbol}: Ù‚ÛŒÙ…Øª {info.get('price'):,} - ØªØºÛŒÛŒØ± {info.get('change_percent')}%")

    def get_historical_data(self, symbol: str, days: int = 30):
        """Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ"""
        history = self.client.get_price_history(symbol)
        return history[-days:] if history else []

    def monitor_realtime(self):
        """Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ"""
        while True:
            self.analyze_market()
            time.sleep(60)  # Ù‡Ø± Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ

# Ø§Ø³ØªÙØ§Ø¯Ù‡
if __name__ == "__main__":
    trader = TSETMCTrader()
    trader.analyze_market()

    # Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ ÙÙˆÙ„Ø§Ø¯
    history = trader.get_historical_data("ÙÙˆÙ„Ø§Ø¯", 7)
    print(f"Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ ÙÙˆÙ„Ø§Ø¯: {len(history)} Ø±Ú©ÙˆØ±Ø¯")
```

## Ù…Ù†Ø§Ø¨Ø¹ Ø§Ø¶Ø§ÙÛŒ

- [Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø³Ù…ÛŒ BRS API](https://brsapi.ir)
- [Ø³Ø§ÛŒØª TSETMC](https://www.tsetmc.com)
- [Ú©Ø¯ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†](https://github.com/brsapi/python-examples)

## Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ø§Ù…Ù„

```python
import os
import time
import requests
from typing import Dict, List, Any
from dotenv import load_dotenv
from datetime import datetime, timedelta
import pandas as pd
import matplotlib.pyplot as plt

load_dotenv()

class TSETMCTrader:
    def __init__(self):
        self.client = TSETMCClient(os.getenv("BRS_API_KEY"))
        self.watchlist = ["ÙÙˆÙ„Ø§Ø¯", "Ø´Ù¾Ù†Ø§", "ÙˆØªØ¬Ø§Ø±Øª", "Ø´ÛŒØ±Ø§Ø²", "ØºÚ¯Ù„"]

    def analyze_market(self):
        """ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ Ø¨Ø§Ø²Ø§Ø±"""
        print("ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±..."        print(f"ğŸ“… ØªØ§Ø±ÛŒØ®: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

        # Ø¯Ø±ÛŒØ§ÙØª Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§
        indices = self.client.get_indices()
        for index in indices[:3]:  # Û³ Ø´Ø§Ø®Øµ Ø§ÙˆÙ„
            print(f"ğŸ“ˆ Ø´Ø§Ø®Øµ {index['name']}: {index['value']:,} ({index['change_percent']:+.2f}%)")

        # ØªØ­Ù„ÛŒÙ„ Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒØ¯Ù‡â€ŒØ¨Ø§Ù†ÛŒ
        for symbol in self.watchlist:
            info = self.client.get_symbol_info(symbol)
            if info:
                price = info.get('price', 0)
                change = info.get('change_percent', 0)
                volume = info.get('volume', 0)
                print(f"ğŸ’° {symbol}: Ù‚ÛŒÙ…Øª {price:,} - ØªØºÛŒÛŒØ± {change:+.2f}% - Ø­Ø¬Ù… {volume:,}")

    def get_historical_data(self, symbol: str, days: int = 30) -> pd.DataFrame:
        """Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ DataFrame"""
        history = self.client.get_price_history(symbol)
        if not history:
            return pd.DataFrame()

        df = pd.DataFrame(history)
        df['date'] = pd.to_datetime(df['date'])
        df = df.set_index('date')
        df = df.sort_index()

        # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡
        df['SMA_20'] = df['close'].rolling(window=20).mean()
        df['SMA_50'] = df['close'].rolling(window=50).mean()

        return df.tail(days)

    def technical_analysis(self, symbol: str) -> Dict[str, Any]:
        """ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ø³Ø§Ø¯Ù‡"""
        df = self.get_historical_data(symbol, 100)
        if df.empty:
            return {"error": "No data available"}

        latest = df.iloc[-1]
        prev = df.iloc[-2]

        signals = {
            "symbol": symbol,
            "price": latest['close'],
            "sma_20": latest['SMA_20'],
            "sma_50": latest['SMA_50'],
            "trend": "ØµØ¹ÙˆØ¯ÛŒ" if latest['SMA_20'] > latest['SMA_50'] else "Ù†Ø²ÙˆÙ„ÛŒ",
            "momentum": "Ù‚ÙˆÛŒ" if latest['close'] > prev['close'] else "Ø¶Ø¹ÛŒÙ"
        }

        return signals

    def monitor_realtime(self, interval_minutes: int = 5):
        """Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¨Ø§ ØªØ­Ù„ÛŒÙ„"""
        print(f"ğŸ”„ Ø´Ø±ÙˆØ¹ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù‡Ø± {interval_minutes} Ø¯Ù‚ÛŒÙ‚Ù‡... (Ctrl+C Ø¨Ø±Ø§ÛŒ ØªÙˆÙ‚Ù)")

        try:
            while True:
                self.analyze_market()
                print("\n" + "="*50 + "\n")

                # ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„
                for symbol in self.watchlist[:2]:  # ÙÙ‚Ø· Û² Ù†Ù…Ø§Ø¯ Ø§ÙˆÙ„
                    analysis = self.technical_analysis(symbol)
                    if "error" not in analysis:
                        print(f"ğŸ“Š ØªØ­Ù„ÛŒÙ„ {symbol}: Ø±ÙˆÙ†Ø¯ {analysis['trend']} - Ø­Ø±Ú©Øª {analysis['momentum']}")

                time.sleep(interval_minutes * 60)

        except KeyboardInterrupt:
            print("\nâ¹ï¸ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù…ØªÙˆÙ‚Ù Ø´Ø¯")

    def export_data(self, symbol: str, filename: str = None):
        """Ø§Ú©Ø³Ù¾ÙˆØ±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ CSV"""
        df = self.get_historical_data(symbol, 365)  # ÛŒÚ© Ø³Ø§Ù„
        if df.empty:
            print(f"âŒ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ {symbol} ÛŒØ§ÙØª Ù†Ø´Ø¯")
            return

        if not filename:
            filename = f"{symbol}_data.csv"

        df.to_csv(filename)
        print(f"âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ {symbol} Ø¯Ø± {filename} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ ({len(df)} Ø±Ú©ÙˆØ±Ø¯)")

# Ø§Ø³ØªÙØ§Ø¯Ù‡
if __name__ == "__main__":
    trader = TSETMCTrader()

    # ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±
    trader.analyze_market()

    print("\n" + "="*50)

    # ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ ÛŒÚ© Ù†Ù…Ø§Ø¯
    analysis = trader.technical_analysis("ÙÙˆÙ„Ø§Ø¯")
    print(f"ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ ÙÙˆÙ„Ø§Ø¯: {analysis}")

    print("\n" + "="*50)

    # Ø§Ú©Ø³Ù¾ÙˆØ±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    trader.export_data("ÙÙˆÙ„Ø§Ø¯")

    # Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ:
    # trader.monitor_realtime(10)  # Ù‡Ø± Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡
```

## Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

### ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ø¨Ø§ TA-Lib

```python
import talib
import numpy as np

def advanced_technical_analysis(df: pd.DataFrame) -> Dict[str, Any]:
    """ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ù¾ÛŒØ´Ø±ÙØªÙ‡"""
    if len(df) < 50:
        return {"error": "Not enough data"}

    close = df['close'].values
    high = df['high'].values
    low = df['low'].values

    # RSI
    rsi = talib.RSI(close, timeperiod=14)

    # MACD
    macd, macdsignal, macdhist = talib.MACD(close, fastperiod=12, slowperiod=26, signalperiod=9)

    # Bollinger Bands
    upperband, middleband, lowerband = talib.BBANDS(close, timeperiod=20, nbdevup=2, nbdevdn=2, matype=0)

    # Stochastic
    slowk, slowd = talib.STOCH(high, low, close, fastk_period=14, slowk_period=3, slowd_period=3)

    latest = {
        "rsi": rsi[-1],
        "macd": macd[-1],
        "macd_signal": macdsignal[-1],
        "macd_hist": macdhist[-1],
        "bb_upper": upperband[-1],
        "bb_middle": middleband[-1],
        "bb_lower": lowerband[-1],
        "stoch_k": slowk[-1],
        "stoch_d": slowd[-1],
        "price": close[-1]
    }

    # Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´
    signals = []

    # RSI Ø³ÛŒÚ¯Ù†Ø§Ù„
    if latest['rsi'] < 30:
        signals.append("RSI Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯ (Ú©Ù…â€ŒÙØ±ÙˆØ´)")
    elif latest['rsi'] > 70:
        signals.append("RSI Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´ (Ù¾Ø±Ú©ÛŒÙ)")

    # MACD Ø³ÛŒÚ¯Ù†Ø§Ù„
    if latest['macd'] > latest['macd_signal'] and macd[-2] <= macdsignal[-2]:
        signals.append("MACD Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯")
    elif latest['macd'] < latest['macd_signal'] and macd[-2] >= macdsignal[-2]:
        signals.append("MACD Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´")

    # Bollinger Bands Ø³ÛŒÚ¯Ù†Ø§Ù„
    if latest['price'] <= latest['bb_lower']:
        signals.append("BB Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯ (Ù„Ù…Ø³ Ø¨Ø§Ù†Ø¯ Ù¾Ø§ÛŒÛŒÙ†)")
    elif latest['price'] >= latest['bb_upper']:
        signals.append("BB Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´ (Ù„Ù…Ø³ Ø¨Ø§Ù†Ø¯ Ø¨Ø§Ù„Ø§)")

    return {
        "indicators": latest,
        "signals": signals,
        "signal_count": len(signals)
    }

# Ø§Ø³ØªÙØ§Ø¯Ù‡
analysis = advanced_technical_analysis(df)
print(f"Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ {symbol}: {analysis['signals']}")
```

### ØªØ­Ù„ÛŒÙ„ Ø¨Ù†ÛŒØ§Ø¯ÛŒ Ø³Ø§Ø¯Ù‡

```python
def fundamental_analysis(symbol: str) -> Dict[str, Any]:
    """ØªØ­Ù„ÛŒÙ„ Ø¨Ù†ÛŒØ§Ø¯ÛŒ Ø³Ø§Ø¯Ù‡"""
    # Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø±Ú©Øª
    info = client.get_symbol_info(symbol)
    shareholders = client.get_shareholders(symbol)

    if not info or not shareholders:
        return {"error": "Data not available"}

    market_cap = info.get('market_cap', 0)
    price = info.get('price', 0)

    # Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÙ…Ø±Ú©Ø² Ù…Ø§Ù„Ú©ÛŒØª
    total_shares = sum(s.get('shares', 0) for s in shareholders)
    major_shareholders = [s for s in shareholders if s.get('percentage', 0) > 5]

    concentration = {
        "total_shareholders": len(shareholders),
        "major_shareholders": len(major_shareholders),
        "concentration_ratio": len(major_shareholders) / len(shareholders) if shareholders else 0,
        "largest_shareholder": max((s.get('percentage', 0) for s in shareholders), default=0)
    }

    # ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡
    analysis = {
        "symbol": symbol,
        "market_cap": market_cap,
        "pe_ratio": info.get('pe_ratio'),
        "concentration": concentration,
        "ownership_type": "Ù…ØªÙ…Ø±Ú©Ø²" if concentration['concentration_ratio'] > 0.3 else "Ù¾Ø®Ø´ Ø´Ø¯Ù‡"
    }

    return analysis
```

## ÙˆÛŒÚ˜ÙˆØ§Ù„ÛŒØ²ÛŒØ´Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

### Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø¨Ø§ Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§

```python
def plot_technical_chart(symbol: str, days: int = 90):
    """Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø± ØªÚ©Ù†ÛŒÚ©Ø§Ù„"""
    df = trader.get_historical_data(symbol, days)

    if df.empty:
        print(f"âŒ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ {symbol} ÛŒØ§ÙØª Ù†Ø´Ø¯")
        return

    fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(15, 10), sharex=True)

    # Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª Ùˆ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†â€ŒÙ‡Ø§
    ax1.plot(df.index, df['close'], label='Close Price', color='blue', linewidth=2)
    ax1.plot(df.index, df['SMA_20'], label='SMA 20', color='orange', linestyle='--')
    ax1.plot(df.index, df['SMA_50'], label='SMA 50', color='red', linestyle='--')
    ax1.set_title(f'Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª {symbol}')
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    # Ù†Ù…ÙˆØ¯Ø§Ø± Ø­Ø¬Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª
    ax2.bar(df.index, df['volume'], color='green', alpha=0.7)
    ax2.set_title('Ø­Ø¬Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª')
    ax2.grid(True, alpha=0.3)

    # RSI
    if 'RSI' in df.columns:
        ax3.plot(df.index, df['RSI'], color='purple', linewidth=2)
        ax3.axhline(y=70, color='red', linestyle='--', alpha=0.7)
        ax3.axhline(y=30, color='green', linestyle='--', alpha=0.7)
        ax3.fill_between(df.index, 30, 70, alpha=0.1, color='gray')
        ax3.set_title('RSI (14)')
        ax3.set_ylim(0, 100)
        ax3.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.savefig(f'{symbol}_technical_chart.png', dpi=300, bbox_inches='tight')
    plt.show()

    print(f"âœ… Ù†Ù…ÙˆØ¯Ø§Ø± {symbol} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯")

# Ø§Ø³ØªÙØ§Ø¯Ù‡
plot_technical_chart("ÙÙˆÙ„Ø§Ø¯", 60)
```

### Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù†Ù…Ø§Ø¯Ù‡Ø§

```python
def compare_symbols(symbols: List[str], days: int = 30):
    """Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù†Ù…Ø§Ø¯Ù‡Ø§"""
    plt.figure(figsize=(15, 8))

    for symbol in symbols:
        df = trader.get_historical_data(symbol, days)
        if not df.empty:
            # Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±
            start_price = df['close'].iloc[0]
            normalized = (df['close'] / start_price - 1) * 100
            plt.plot(df.index, normalized, label=symbol, linewidth=2)

    plt.title('Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù†Ù…Ø§Ø¯Ù‡Ø§ (ØªØºÛŒÛŒØ± Ø¯Ø±ØµØ¯ÛŒ)')
    plt.xlabel('ØªØ§Ø±ÛŒØ®')
    plt.ylabel('ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª (%)')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.axhline(y=0, color='black', linestyle='-', alpha=0.8)
    plt.tight_layout()
    plt.savefig('symbols_comparison.png', dpi=300, bbox_inches='tight')
    plt.show()

# Ø§Ø³ØªÙØ§Ø¯Ù‡
compare_symbols(["ÙÙˆÙ„Ø§Ø¯", "Ø´Ù¾Ù†Ø§", "ÙˆØªØ¬Ø§Ø±Øª"], 30)
```

## Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡

### Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ

```
tsetmc_project/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ .env                    # API keys and settings
â”‚   â””â”€â”€ settings.py            # Configuration
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ client.py              # TSETMC API client
â”‚   â”œâ”€â”€ analyzer.py            # Analysis functions
â”‚   â”œâ”€â”€ visualizer.py          # Charts and plots
â”‚   â””â”€â”€ trader.py              # Trading logic
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ cache/                 # Cached data
â”‚   â””â”€â”€ exports/               # Exported files
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_client.py
â”‚   â”œâ”€â”€ test_analyzer.py
â”‚   â””â”€â”€ test_integration.py
â”œâ”€â”€ notebooks/
â”‚   â””â”€â”€ exploration.ipynb      # Jupyter notebooks
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ app.log
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ main.py                    # Entry point
â””â”€â”€ README.md
```

### ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª (config/settings.py)

```python
import os
from pathlib import Path

# Paths
PROJECT_ROOT = Path(__file__).parent.parent
DATA_DIR = PROJECT_ROOT / "data"
CACHE_DIR = DATA_DIR / "cache"
EXPORT_DIR = DATA_DIR / "exports"
LOG_DIR = PROJECT_ROOT / "logs"

# API Settings
API_KEY = os.getenv("BRS_API_KEY")
BASE_URL = "https://brsapi.ir"
REQUEST_TIMEOUT = 30
MAX_RETRIES = 3

# Rate Limiting
MAX_REQUESTS_PER_MINUTE = 60
DAILY_QUOTA = 50000

# Cache Settings
CACHE_TTL_HOURS = 24
MAX_CACHE_SIZE_MB = 100

# Logging
LOG_LEVEL = "INFO"
LOG_FORMAT = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Watchlist
DEFAULT_WATCHLIST = ["ÙÙˆÙ„Ø§Ø¯", "Ø´Ù¾Ù†Ø§", "ÙˆØªØ¬Ø§Ø±Øª", "Ø´ÛŒØ±Ø§Ø²", "ØºÚ¯Ù„"]
```

### Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯â€ŒÚ¯ÛŒØ±ÛŒ

```python
import logging
from config.settings import LOG_DIR, LOG_LEVEL, LOG_FORMAT

def setup_logging():
    """Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯â€ŒÚ¯ÛŒØ±ÛŒ"""
    LOG_DIR.mkdir(exist_ok=True)

    logging.basicConfig(
        level=getattr(logging, LOG_LEVEL),
        format=LOG_FORMAT,
        handlers=[
            logging.FileHandler(LOG_DIR / "app.log"),
            logging.StreamHandler()
        ]
    )

    # Ù„Ø§Ú¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ API
    api_logger = logging.getLogger("api")
    api_handler = logging.FileHandler(LOG_DIR / "api.log")
    api_handler.setFormatter(logging.Formatter(LOG_FORMAT))
    api_logger.addHandler(api_handler)
    api_logger.setLevel(logging.INFO)

setup_logging()
logger = logging.getLogger(__name__)
```

## ØªØ³Øª Ùˆ Ø¯ÛŒØ¨Ø§Ú¯ÛŒÙ†Ú¯

### ØªØ³Øª ÙˆØ§Ø­Ø¯ API Client

```python
import unittest
from unittest.mock import Mock, patch
import sys
import os

# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ù¾Ø±ÙˆÚ˜Ù‡
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from src.client import TSETMCClient

class TestTSETMCClient(unittest.TestCase):

    def setUp(self):
        self.client = TSETMCClient("test_key")

    @patch('src.client.requests.Session.get')
    def test_get_symbols_success(self, mock_get):
        # Mock response
        mock_response = Mock()
        mock_response.json.return_value = [
            {"l18": "ÙÙˆÙ„Ø§Ø¯", "l30": "ÙÙˆÙ„Ø§Ø¯ Ù…Ø¨Ø§Ø±Ú©Ù‡"},
            {"l18": "Ø´Ù¾Ù†Ø§", "l30": "Ù¾Ø§Ù„Ø§ÛŒØ´ Ù†ÙØª Ø§ØµÙÙ‡Ø§Ù†"}
        ]
        mock_get.return_value = mock_response

        symbols = self.client.get_all_symbols()
        self.assertEqual(len(symbols), 2)
        self.assertEqual(symbols[0]["l18"], "ÙÙˆÙ„Ø§Ø¯")

    @patch('src.client.requests.Session.get')
    def test_get_symbols_failure(self, mock_get):
        mock_get.side_effect = Exception("Connection error")

        symbols = self.client.get_all_symbols()
        self.assertEqual(symbols, [])

    def test_rate_limiting(self):
        # ØªØ³Øª Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø®
        pass

if __name__ == '__main__':
    unittest.main()
```

### ØªØ³Øª Ø§Ù†ØªÚ¯Ø±Ø§Ø³ÛŒÙˆÙ†

```python
import pytest
from src.client import TSETMCClient
from config.settings import API_KEY

class TestIntegration:

    @pytest.fixture
    def client(self):
        return TSETMCClient(API_KEY)

    def test_real_api_connection(self, client):
        """ØªØ³Øª Ø§ØªØµØ§Ù„ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ù‡ API"""
        symbols = client.get_all_symbols()
        assert isinstance(symbols, list)
        assert len(symbols) > 0

        # Ú†Ú© Ú©Ø±Ø¯Ù† Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡
        symbol = symbols[0]
        assert "l18" in symbol
        assert "l30" in symbol

    def test_symbol_data_quality(self, client):
        """ØªØ³Øª Ú©ÛŒÙÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§Ø¯"""
        symbols = client.get_all_symbols()
        if symbols:
            symbol_code = symbols[0]["l18"]
            history = client.get_price_history(symbol_code)

            if history:  # Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ø¯
                record = history[0]
                required_fields = ["date", "open", "high", "low", "close", "volume"]

                for field in required_fields:
                    assert field in record, f"ÙÛŒÙ„Ø¯ {field} Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª"

                # Ú†Ú© Ú©Ø±Ø¯Ù† Ù…Ù†Ø·Ù‚ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                assert record["high"] >= record["low"], "high Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² low Ø¨Ø§Ø´Ø¯"
                assert record["close"] >= 0, "Ù‚ÛŒÙ…Øª close Ø¨Ø§ÛŒØ¯ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯"

    def test_error_handling(self, client):
        """ØªØ³Øª Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§"""
        # ØªØ³Øª Ø¨Ø§ Ù†Ù…Ø§Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±
        history = client.get_price_history("Ù†Ù…Ø§Ø¯_Ù†Ø§Ù…Ø¹ØªØ¨Ø±_12345")
        assert history == []  # Ø¨Ø§ÛŒØ¯ Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯

        # ØªØ³Øª Ø¨Ø§ API key Ù†Ø§Ù…Ø¹ØªØ¨Ø±
        invalid_client = TSETMCClient("invalid_key")
        symbols = invalid_client.get_all_symbols()
        assert symbols == []  # Ø¨Ø§ÛŒØ¯ Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯
```

### Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§

```bash
# Ù†ØµØ¨ pytest
pip install pytest pytest-cov

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
pytest tests/ -v

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù¾ÙˆØ´Ø´ Ú©Ø¯
pytest tests/ --cov=src --cov-report=html

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªÚ¯Ø±Ø§Ø³ÛŒÙˆÙ† (Ù†ÛŒØ§Ø² Ø¨Ù‡ API key ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø§Ø±Ø¯)
pytest tests/test_integration.py -v -k "not real_api"
```

## Ù†Ú©Ø§Øª Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯

### Û±. Ú©Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯

```python
from cachetools import TTLCache, cached
import pickle
from pathlib import Path

class SmartCache:
    def __init__(self, cache_dir: Path, ttl_seconds: int = 3600):
        self.cache_dir = cache_dir
        self.cache_dir.mkdir(exist_ok=True)
        self.memory_cache = TTLCache(maxsize=1000, ttl=ttl_seconds)

    def _get_cache_path(self, key: str) -> Path:
        return self.cache_dir / f"{key}.pkl"

    def get(self, key: str):
        # Ø§ÙˆÙ„ Ø§Ø² Ú©Ø´ Ø­Ø§ÙØ¸Ù‡ Ú†Ú© Ú©Ù†
        if key in self.memory_cache:
            return self.memory_cache[key]

        # Ø³Ù¾Ø³ Ø§Ø² ÙØ§ÛŒÙ„ Ú†Ú© Ú©Ù†
        cache_path = self._get_cache_path(key)
        if cache_path.exists():
            try:
                with open(cache_path, 'rb') as f:
                    data = pickle.load(f)
                # Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´ Ø­Ø§ÙØ¸Ù‡
                self.memory_cache[key] = data
                return data
            except Exception:
                pass

        return None

    def set(self, key: str, value):
        # Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´ Ø­Ø§ÙØ¸Ù‡
        self.memory_cache[key] = value

        # Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„
        cache_path = self._get_cache_path(key)
        try:
            with open(cache_path, 'wb') as f:
                pickle.dump(value, f)
        except Exception as e:
            print(f"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú©Ø´: {e}")

# Ø§Ø³ØªÙØ§Ø¯Ù‡
cache = SmartCache(Path("data/cache"))

@cached(cache.memory_cache)
def get_expensive_data(symbol: str):
    # Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± Ø¯Ø± Ø³Ø§Ø¹Øª Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    return client.get_price_history(symbol)
```

### Û². Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ÙˆØ§Ø²ÛŒ Ø§ÛŒÙ…Ù†

```python
from concurrent.futures import ThreadPoolExecutor, as_completed
from threading import Semaphore
import time

class SafeParallelProcessor:
    def __init__(self, max_workers: int = 3, requests_per_minute: int = 60):
        self.max_workers = max_workers
        self.semaphore = Semaphore(requests_per_minute)
        self.last_request_time = 0
        self.min_interval = 60 / requests_per_minute

    def _wait_for_rate_limit(self):
        """Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ø¹Ø§ÛŒØª Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø®"""
        current_time = time.time()
        time_since_last = current_time - self.last_request_time

        if time_since_last < self.min_interval:
            time.sleep(self.min_interval - time_since_last)

        self.last_request_time = time.time()

    def process_symbols_parallel(self, symbols: List[str], func) -> Dict[str, Any]:
        """Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ÙˆØ§Ø²ÛŒ Ø§ÛŒÙ…Ù†"""
        results = {}

        with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            future_to_symbol = {
                executor.submit(self._safe_request, symbol, func): symbol
                for symbol in symbols
            }

            for future in as_completed(future_to_symbol):
                symbol = future_to_symbol[future]
                try:
                    results[symbol] = future.result()
                except Exception as e:
                    print(f"Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ {symbol}: {e}")
                    results[symbol] = None

        return results

    def _safe_request(self, symbol: str, func):
        """Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ÛŒÙ…Ù†"""
        with self.semaphore:
            self._wait_for_rate_limit()
            return func(symbol)

# Ø§Ø³ØªÙØ§Ø¯Ù‡
processor = SafeParallelProcessor(max_workers=3, requests_per_minute=60)

def fetch_symbol_data(symbol):
    return client.get_price_history(symbol)

results = processor.process_symbols_parallel(
    ["ÙÙˆÙ„Ø§Ø¯", "Ø´Ù¾Ù†Ø§", "ÙˆØªØ¬Ø§Ø±Øª"],
    fetch_symbol_data
)
```

### Û³. Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡

```python
import gc
from typing import Iterator

def process_large_dataset(symbols: List[str]) -> Iterator[Dict]:
    """Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø¨Ù‡ ØµÙˆØ±Øª streaming"""
    for symbol in symbols:
        data = client.get_price_history(symbol)

        if data:
            # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            processed = process_symbol_data(data)
            yield processed

        # Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡
        del data
        gc.collect()

def process_symbol_data(data: List[Dict]) -> Dict:
    """Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ù†Ù…Ø§Ø¯"""
    df = pd.DataFrame(data)

    # Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ù†Ú¯ÛŒÙ†
    df['returns'] = df['close'].pct_change()
    df['volatility'] = df['returns'].rolling(20).std()

    # ÙÙ‚Ø· Ù†ØªØ§ÛŒØ¬ Ù…Ù‡Ù… Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±
    return {
        'symbol': data[0].get('symbol'),
        'avg_volume': df['volume'].mean(),
        'volatility': df['volatility'].iloc[-1],
        'total_return': (df['close'].iloc[-1] / df['close'].iloc[0] - 1) * 100
    }

# Ø§Ø³ØªÙØ§Ø¯Ù‡
for result in process_large_dataset(all_symbols):
    print(f"{result['symbol']}: Ø¨Ø§Ø²Ø¯Ù‡ÛŒ {result['total_return']:.2f}%")
```

## Ø§Ù…Ù†ÛŒØª Ùˆ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯

### Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² API

```python
import psutil
import time
from datetime import datetime, timedelta

class APIMonitor:
    def __init__(self):
        self.requests_log = []
        self.start_time = datetime.now()

    def log_request(self, endpoint: str, success: bool, response_time: float):
        """Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª"""
        self.requests_log.append({
            'timestamp': datetime.now(),
            'endpoint': endpoint,
            'success': success,
            'response_time': response_time
        })

    def get_stats(self) -> Dict:
        """Ø¢Ù…Ø§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡"""
        total_requests = len(self.requests_log)
        successful_requests = len([r for r in self.requests_log if r['success']])
        failed_requests = total_requests - successful_requests

        if self.requests_log:
            avg_response_time = sum(r['response_time'] for r in self.requests_log) / total_requests
            min_response_time = min(r['response_time'] for r in self.requests_log)
            max_response_time = max(r['response_time'] for r in self.requests_log)
        else:
            avg_response_time = min_response_time = max_response_time = 0

        # Ø¢Ù…Ø§Ø± Ø³Ø§Ø¹ØªÛŒ
        hourly_stats = {}
        for request in self.requests_log:
            hour = request['timestamp'].strftime('%Y-%m-%d %H:00')
            if hour not in hourly_stats:
                hourly_stats[hour] = 0
            hourly_stats[hour] += 1

        return {
            'total_requests': total_requests,
            'successful_requests': successful_requests,
            'failed_requests': failed_requests,
            'success_rate': successful_requests / total_requests if total_requests > 0 else 0,
            'avg_response_time': avg_response_time,
            'min_response_time': min_response_time,
            'max_response_time': max_response_time,
            'hourly_stats': hourly_stats,
            'uptime': str(datetime.now() - self.start_time)
        }

    def generate_report(self) -> str:
        """ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´"""
        stats = self.get_stats()

        report = f"""
Ú¯Ø²Ø§Ø±Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² API
==================

Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹: {self.start_time}
Ø¢Ù¾â€ŒØªØ§ÛŒÙ…: {stats['uptime']}

Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ:
- Ú©Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§: {stats['total_requests']}
- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: {stats['successful_requests']}
- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: {stats['failed_requests']}
- Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª: {stats['success_rate']:.2%}

Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®:
- Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: {stats['avg_response_time']:.2f}s
- Ø­Ø¯Ø§Ù‚Ù„: {stats['min_response_time']:.2f}s
- Ø­Ø¯Ø§Ú©Ø«Ø±: {stats['max_response_time']:.2f}s

Ø¢Ù…Ø§Ø± Ø³Ø§Ø¹ØªÛŒ:
"""

        for hour, count in sorted(stats['hourly_stats'].items()):
            report += f"- {hour}: {count} Ø¯Ø±Ø®ÙˆØ§Ø³Øª\n"

        return report

# Ø§Ø³ØªÙØ§Ø¯Ù‡
monitor = APIMonitor()

# Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª
def monitored_request(self, endpoint, *args, **kwargs):
    start_time = time.time()
    try:
        result = self._make_request(endpoint, *args, **kwargs)
        success = True
    except Exception:
        result = None
        success = False

    response_time = time.time() - start_time
    monitor.log_request(endpoint, success, response_time)

    return result

# Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´
print(monitor.generate_report())
```

### Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ

```python
import smtplib
from email.mime.text import MIMEText

class SecurityMonitor:
    def __init__(self, alert_email: str = None):
        self.alert_email = alert_email
        self.alerts = []

    def check_rate_limit_violation(self, requests_per_minute: int):
        """Ø¨Ø±Ø±Ø³ÛŒ violation Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø®"""
        if requests_per_minute > 60:  # Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø²
            alert = f"âš ï¸ VIOLATION: {requests_per_minute} requests/minute (limit: 60)"
            self.alerts.append(alert)
            self.send_alert(alert)

    def check_api_key_exposure(self, code_content: str):
        """Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙØ´Ø§ÛŒ API key"""
        import re
        api_key_pattern = r'BA9C8JBliDmfPapn9WYTX76uR5Q3m2r3'  # Ø§Ù„Ú¯ÙˆÛŒ API key

        if re.search(api_key_pattern, code_content):
            alert = "ğŸš¨ SECURITY: API key found in code!"
            self.alerts.append(alert)
            self.send_alert(alert)

    def send_alert(self, message: str):
        """Ø§Ø±Ø³Ø§Ù„ Ù‡Ø´Ø¯Ø§Ø±"""
        if not self.alert_email:
            print(message)
            return

        try:
            msg = MIMEText(message)
            msg['Subject'] = 'TSETMC API Security Alert'
            msg['From'] = 'security@tsetmc.local'
            msg['To'] = self.alert_email

            # Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ (Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ SMTP Ù†ÛŒØ§Ø² Ø§Ø³Øª)
            # server = smtplib.SMTP('localhost')
            # server.send_message(msg)
            # server.quit()

            print(f"Alert sent: {message}")
        except Exception as e:
            print(f"Failed to send alert: {e}")

# Ø§Ø³ØªÙØ§Ø¯Ù‡
security = SecurityMonitor("admin@example.com")

# Ú†Ú© Ú©Ø±Ø¯Ù† Ú©Ø¯ Ø¨Ø±Ø§ÛŒ API key
with open('config.py', 'r') as f:
    security.check_api_key_exposure(f.read())
```

---

**Ù†Ú©ØªÙ‡ Ù†Ù‡Ø§ÛŒÛŒ:** Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø´Ø±ÙˆØ¹ Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù†Ø¯ Ø§Ø² API ÙˆØ¨ Ø³Ø±ÙˆÛŒØ³ TSETMC Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù†Ø¯. Ø¨Ø§ Ø±Ø¹Ø§ÛŒØª ØªÙ…Ø§Ù… Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´â€ŒÙ‡Ø§ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ Ùˆ Ù‚Ø§Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯ÛŒ Ø¨Ø³Ø§Ø²ÛŒØ¯.

Ø¨Ø±Ø§ÛŒ Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª Ùˆ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒÙ‡Ø§ØŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø³Ù…ÛŒ BrsApi.ir Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.